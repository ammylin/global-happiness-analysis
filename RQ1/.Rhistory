)
plot_data <- lapply(names(gdp_levels), function(level_name) {
data.frame(
lifeexp_index    = life_exp_range,
gdp_index        = gdp_levels[[level_name]],
GDP_Level        = level_name,
family_index     = mean(happiness$family_index, na.rm = TRUE),
freedom_index    = mean(happiness$freedom_index, na.rm = TRUE),
trust_index      = mean(happiness$trust_index, na.rm = TRUE),
generosity_index = mean(happiness$generosity_index, na.rm = TRUE),
year             = mean(happiness$year, na.rm = TRUE)
)
}) |> bind_rows()
preds <- predict(rq1_model, newdata = plot_data, interval = "confidence")
plot_data <- cbind(plot_data, preds)
ggplot(
plot_data,
aes(x = lifeexp_index, y = fit, color = GDP_Level, fill = GDP_Level)
) +
geom_line(linewidth = 1.2) +
geom_ribbon(aes(ymin = lwr, ymax = upr), alpha = 0.2, color = NA) +
theme_minimal() +
labs(
title    = "Interaction of Life Expectancy and GDP on Happiness",
subtitle = "Life expectancy has a stronger association with happiness at higher GDP levels",
x        = "Life expectancy index",
y        = "Predicted happiness score",
color    = "Economic status",
fill     = "Economic status"
) +
scale_color_manual(
values = c("Low GDP" = "#d73027", "Average GDP" = "#fee090", "High GDP" = "#4575b4")
) +
scale_fill_manual(
values = c("Low GDP" = "#d73027", "Average GDP" = "#fee090", "High GDP" = "#4575b4")
)
library(ggplot2)
library(dplyr)
life_exp_range <- seq(
min(happiness$lifeexp_index, na.rm = TRUE),
max(happiness$lifeexp_index, na.rm = TRUE),
length.out = 100
)
gdp_levels <- c(
"Low GDP"     = quantile(happiness$gdp_index, 0.1, na.rm = TRUE),
"Average GDP" = mean(happiness$gdp_index, na.rm = TRUE),
"High GDP"    = quantile(happiness$gdp_index, 0.9, na.rm = TRUE)
)
plot_data <- lapply(names(gdp_levels), function(level_name) {
data.frame(
lifeexp_index    = life_exp_range,
gdp_index        = gdp_levels[[level_name]],
GDP_Level        = level_name,
family_index     = mean(happiness$family_index, na.rm = TRUE),
freedom_index    = mean(happiness$freedom_index, na.rm = TRUE),
trust_index      = mean(happiness$trust_index, na.rm = TRUE),
generosity_index = mean(happiness$generosity_index, na.rm = TRUE),
year             = mean(happiness$year, na.rm = TRUE)
)
}) |> bind_rows()
preds <- predict(rq1_model, newdata = plot_data, interval = "confidence")
plot_data <- cbind(plot_data, preds)
ggplot(
plot_data,
aes(x = lifeexp_index, y = fit, color = GDP_Level, fill = GDP_Level)
) +
geom_line(linewidth = 1.2) +
geom_ribbon(aes(ymin = lwr, ymax = upr), alpha = 0.2, color = NA) +
theme_minimal() +
labs(
title    = "Interaction of Life Expectancy and GDP on Happiness",
subtitle = "Life expectancy has a stronger association with happiness at higher GDP levels",
x        = "Life expectancy index",
y        = "Predicted happiness score",
color    = "Economic status",
fill     = "Economic status"
) +
scale_color_manual(
values = c("Low GDP" = "#d73027", "Average GDP" = "#fee090", "High GDP" = "#4575b4")
) +
scale_fill_manual(
values = c("Low GDP" = "#d73027", "Average GDP" = "#fee090", "High GDP" = "#4575b4")
)
library(dplyr)
library(lmtest)
library(sandwich)
library(knitr)
library(kableExtra)
rq1_model <- lm(
score ~ lifeexp_index * gdp_index +
lifeexp_index * year +
gdp_index * year +
family_index +
freedom_index +
trust_index +
generosity_index +
year,
data = happiness
)
model_summary <- summary(rq1_model)
r2_value <- model_summary$r.squared
adj_r2   <- model_summary$adj.r.squared
cluster_vcov <- sandwich::vcovCL(rq1_model, cluster = ~ country)
coefs_robust <- lmtest::coeftest(rq1_model, vcov = cluster_vcov)
crit_val <- qt(0.975, df = rq1_model$df.residual)
rq1_table <- data.frame(
term      = rownames(coefs_robust),
estimate  = coefs_robust[, "Estimate"],
std.error = coefs_robust[, "Std. Error"],
statistic = coefs_robust[, "t value"],
p.value   = coefs_robust[, "Pr(>|t|)"],
stringsAsFactors = FALSE
) %>%
mutate(
conf.low  = estimate - crit_val * std.error,
conf.high = estimate + crit_val * std.error
) %>%
mutate(
term = dplyr::recode(
term,
"(Intercept)"              = "Intercept",
"lifeexp_index"           = "Life expectancy index",
"gdp_index"               = "GDP per capita index",
"family_index"            = "Family index",
"freedom_index"           = "Freedom index",
"trust_index"             = "Trust index",
"generosity_index"        = "Generosity index",
"year"                    = "Year",
"lifeexp_index:gdp_index" = "Life expectancy × GDP per capita",
"lifeexp_index:year"      = "Life expectancy × Year",
"gdp_index:year"          = "GDP per capita × Year"
),
p.value   = ifelse(p.value < 0.001, "<0.001",
sprintf("%.3f", round(p.value, 3))),
estimate  = sprintf("%.3f", round(estimate, 3)),
std.error = sprintf("%.3f", round(std.error, 3)),
statistic = sprintf("%.3f", round(statistic, 3)),
conf.low  = sprintf("%.3f", round(conf.low, 3)),
conf.high = sprintf("%.3f", round(conf.high, 3))
)
rq1_table <- dplyr::bind_rows(
rq1_table,
tibble::tibble(
term      = c("R-squared", "Adjusted R-squared"),
estimate  = c(sprintf("%.3f", round(r2_value, 3)),
sprintf("%.3f", round(adj_r2, 3))),
std.error = "", statistic = "", p.value = "",
conf.low  = "", conf.high = ""
)
)
colnames(rq1_table) <- c(
"Variable", "Estimate", "Std Error", "t-value", "p-value",
"2.5% CI", "97.5% CI"
)
rownames(rq1_table) <- NULL
kable(
rq1_table,
caption = "Linear regression model for national happiness (cluster\u2013robust SEs by country)",
booktabs = TRUE,
linesep  = "",
align    = c("l", "c", "c", "c", "c", "c", "c")
) %>%
kable_styling(full_width = FALSE, font_size = 9) %>%
hold_position()
library(dplyr)
library(lmtest)
library(sandwich)
library(knitr)
library(kableExtra)
rq1_model <- lm(
score ~ lifeexp_index * gdp_index +
lifeexp_index * year +
gdp_index * year +
family_index +
freedom_index +
trust_index +
generosity_index +
year,
data = happiness
)
model_summary <- summary(rq1_model)
r2_value <- model_summary$r.squared
adj_r2   <- model_summary$adj.r.squared
cluster_vcov <- sandwich::vcovCL(rq1_model, cluster = ~ country)
coefs_robust <- lmtest::coeftest(rq1_model, vcov = cluster_vcov)
crit_val <- qt(0.975, df = rq1_model$df.residual)
rq1_table <- data.frame(
term      = rownames(coefs_robust),
estimate  = coefs_robust[, "Estimate"],
std.error = coefs_robust[, "Std. Error"],
statistic = coefs_robust[, "t value"],
p.value   = coefs_robust[, "Pr(>|t|)"],
stringsAsFactors = FALSE
) %>%
mutate(
conf.low  = estimate - crit_val * std.error,
conf.high = estimate + crit_val * std.error
) %>%
mutate(
term = dplyr::recode(
term,
"(Intercept)"              = "Intercept",
"lifeexp_index"           = "Life expectancy index",
"gdp_index"               = "GDP per capita index",
"family_index"            = "Family index",
"freedom_index"           = "Freedom index",
"trust_index"             = "Trust index",
"generosity_index"        = "Generosity index",
"year"                    = "Year",
"lifeexp_index:gdp_index" = "Life expectancy × GDP per capita",
"lifeexp_index:year"      = "Life expectancy × Year",
"gdp_index:year"          = "GDP per capita × Year"
),
p.value   = ifelse(p.value < 0.001, "<0.001",
sprintf("%.3f", round(p.value, 3))),
estimate  = sprintf("%.3f", round(estimate, 3)),
std.error = sprintf("%.3f", round(std.error, 3)),
statistic = sprintf("%.3f", round(statistic, 3)),
conf.low  = sprintf("%.3f", round(conf.low, 3)),
conf.high = sprintf("%.3f", round(conf.high, 3))
)
rq1_table <- dplyr::bind_rows(
rq1_table,
tibble::tibble(
term      = c("R-squared", "Adjusted R-squared"),
estimate  = c(sprintf("%.3f", round(r2_value, 3)),
sprintf("%.3f", round(adj_r2, 3))),
std.error = "", statistic = "", p.value = "",
conf.low  = "", conf.high = ""
)
)
colnames(rq1_table) <- c(
"Variable", "Estimate", "Std Error", "t-value", "p-value",
"2.5% CI", "97.5% CI"
)
rownames(rq1_table) <- NULL
kable(
rq1_table,
caption = "Linear regression model for national happiness (cluster\u2013robust SEs by country)",
booktabs = TRUE,
linesep  = "",
align    = c("l", "c", "c", "c", "c", "c", "c")
) %>%
kable_styling(full_width = FALSE, font_size = 9) %>%
kableExtra::hold_position()
library(tidyverse)
library(dplyr)
library(broom)
library(knitr)
library(kableExtra)
library(ggplot2)
library(dplyr)
happiness <- read.csv("https://github.com/lingyuehao/ids702_Team3/raw/refs/heads/main/data/2015_2019_combined_updated.csv")
happiness <- happiness %>%
rename(
country          = Country,
region           = Region,
score            = Happiness.Score,
gdp_index        = Economy..GDP.per.Capita.,
family_index     = Family,
lifeexp_index    = Health..Life.Expectancy.,
freedom_index    = Freedom,
trust_index      = Trust..Government.Corruption.,
generosity_index = Generosity,
year             = Year
)
glimpse(happiness)
head(happiness)
library(dplyr)
library(lmtest)
library(sandwich)
library(knitr)
library(kableExtra)
rq1_model <- lm(
score ~ lifeexp_index * gdp_index +
lifeexp_index * year +
gdp_index * year +
family_index +
freedom_index +
trust_index +
generosity_index +
year,
data = happiness
)
model_summary <- summary(rq1_model)
r2_value <- model_summary$r.squared
adj_r2   <- model_summary$adj.r.squared
cluster_vcov <- sandwich::vcovCL(rq1_model, cluster = ~ country)
coefs_robust <- lmtest::coeftest(rq1_model, vcov = cluster_vcov)
crit_val <- qt(0.975, df = rq1_model$df.residual)
rq1_table <- data.frame(
term      = rownames(coefs_robust),
estimate  = coefs_robust[, "Estimate"],
std.error = coefs_robust[, "Std. Error"],
statistic = coefs_robust[, "t value"],
p.value   = coefs_robust[, "Pr(>|t|)"],
stringsAsFactors = FALSE
) %>%
mutate(
conf.low  = estimate - crit_val * std.error,
conf.high = estimate + crit_val * std.error
) %>%
mutate(
term = dplyr::recode(
term,
"(Intercept)"              = "Intercept",
"lifeexp_index"           = "Life expectancy index",
"gdp_index"               = "GDP per capita index",
"family_index"            = "Family index",
"freedom_index"           = "Freedom index",
"trust_index"             = "Trust index",
"generosity_index"        = "Generosity index",
"year"                    = "Year",
"lifeexp_index:gdp_index" = "Life expectancy × GDP per capita",
"lifeexp_index:year"      = "Life expectancy × Year",
"gdp_index:year"          = "GDP per capita × Year"
),
p.value   = ifelse(p.value < 0.001, "<0.001",
sprintf("%.3f", round(p.value, 3))),
estimate  = sprintf("%.3f", round(estimate, 3)),
std.error = sprintf("%.3f", round(std.error, 3)),
statistic = sprintf("%.3f", round(statistic, 3)),
conf.low  = sprintf("%.3f", round(conf.low, 3)),
conf.high = sprintf("%.3f", round(conf.high, 3))
)
rq1_table <- dplyr::bind_rows(
rq1_table,
tibble::tibble(
term      = c("R-squared", "Adjusted R-squared"),
estimate  = c(sprintf("%.3f", round(r2_value, 3)),
sprintf("%.3f", round(adj_r2, 3))),
std.error = "", statistic = "", p.value = "",
conf.low  = "", conf.high = ""
)
)
colnames(rq1_table) <- c(
"Variable", "Estimate", "Std Error", "t-value", "p-value",
"2.5% CI", "97.5% CI"
)
rownames(rq1_table) <- NULL
kable(
rq1_table,
caption = "Linear regression model for national happiness (cluster\u2013robust SEs by country)",
booktabs = TRUE,
linesep  = "",
align    = c("l", "c", "c", "c", "c", "c", "c")
) %>%
kableExtra::kable_styling(full_width = FALSE, font_size = 9) %>%
kableExtra::hold_position()
library(dplyr)
library(lmtest)
library(sandwich)
library(knitr)
library(kableExtra)
rq1_model <- lm(
score ~ lifeexp_index * gdp_index +
lifeexp_index * year +
gdp_index * year +
family_index +
freedom_index +
trust_index +
generosity_index +
year,
data = happiness
)
model_summary <- summary(rq1_model)
r2_value <- model_summary$r.squared
adj_r2   <- model_summary$adj.r.squared
cluster_vcov <- sandwich::vcovCL(rq1_model, cluster = ~ country)
coefs_robust <- lmtest::coeftest(rq1_model, vcov = cluster_vcov)
crit_val <- qt(0.975, df = rq1_model$df.residual)
rq1_table <- data.frame(
term      = rownames(coefs_robust),
estimate  = coefs_robust[, "Estimate"],
std.error = coefs_robust[, "Std. Error"],
statistic = coefs_robust[, "t value"],
p.value   = coefs_robust[, "Pr(>|t|)"],
stringsAsFactors = FALSE
) %>%
mutate(
conf.low  = estimate - crit_val * std.error,
conf.high = estimate + crit_val * std.error
) %>%
mutate(
term = dplyr::recode(
term,
"(Intercept)"              = "Intercept",
"lifeexp_index"           = "Life expectancy index",
"gdp_index"               = "GDP per capita index",
"family_index"            = "Family index",
"freedom_index"           = "Freedom index",
"trust_index"             = "Trust index",
"generosity_index"        = "Generosity index",
"year"                    = "Year",
"lifeexp_index:gdp_index" = "Life expectancy × GDP per capita",
"lifeexp_index:year"      = "Life expectancy × Year",
"gdp_index:year"          = "GDP per capita × Year"
),
p.value   = ifelse(p.value < 0.001, "<0.001",
sprintf("%.3f", round(p.value, 3))),
estimate  = sprintf("%.3f", round(estimate, 3)),
std.error = sprintf("%.3f", round(std.error, 3)),
statistic = sprintf("%.3f", round(statistic, 3)),
conf.low  = sprintf("%.3f", round(conf.low, 3)),
conf.high = sprintf("%.3f", round(conf.high, 3))
)
rq1_table <- dplyr::bind_rows(
rq1_table,
tibble::tibble(
term      = c("R-squared", "Adjusted R-squared"),
estimate  = c(sprintf("%.3f", round(r2_value, 3)),
sprintf("%.3f", round(adj_r2, 3))),
std.error = "", statistic = "", p.value = "",
conf.low  = "", conf.high = ""
)
)
colnames(rq1_table) <- c(
"Variable", "Estimate", "Std Error", "t-value", "p-value",
"2.5% CI", "97.5% CI"
)
rownames(rq1_table) <- NULL
kable(
rq1_table,
caption = "Linear regression model for national happiness (cluster\u2013robust SEs by country)",
booktabs = TRUE,
linesep  = "",
longtable = FALSE,
align    = c("l", "c", "c", "c", "c", "c", "c")
) %>%
kableExtra::kable_styling(full_width = FALSE, font_size = 9) %>%
kableExtra::hold_position()
library(dplyr)
library(lmtest)
library(sandwich)
library(knitr)
library(kableExtra)
rq1_model <- lm(
score ~ lifeexp_index * gdp_index +
lifeexp_index * year +
gdp_index * year +
family_index +
freedom_index +
trust_index +
generosity_index +
year,
data = happiness
)
model_summary <- summary(rq1_model)
r2_value <- model_summary$r.squared
adj_r2   <- model_summary$adj.r.squared
cluster_vcov <- sandwich::vcovCL(rq1_model, cluster = ~ country)
coefs_robust <- lmtest::coeftest(rq1_model, vcov = cluster_vcov)
crit_val <- qt(0.975, df = rq1_model$df.residual)
rq1_table <- data.frame(
term      = rownames(coefs_robust),
estimate  = coefs_robust[, "Estimate"],
std.error = coefs_robust[, "Std. Error"],
statistic = coefs_robust[, "t value"],
p.value   = coefs_robust[, "Pr(>|t|)"],
stringsAsFactors = FALSE
) %>%
mutate(
conf.low  = estimate - crit_val * std.error,
conf.high = estimate + crit_val * std.error
) %>%
mutate(
term = dplyr::recode(
term,
"(Intercept)"              = "Intercept",
"lifeexp_index"           = "Life expectancy index",
"gdp_index"               = "GDP per capita index",
"family_index"            = "Family index",
"freedom_index"           = "Freedom index",
"trust_index"             = "Trust index",
"generosity_index"        = "Generosity index",
"year"                    = "Year",
"lifeexp_index:gdp_index" = "Life expectancy × GDP per capita",
"lifeexp_index:year"      = "Life expectancy × Year",
"gdp_index:year"          = "GDP per capita × Year"
),
p.value   = ifelse(p.value < 0.001, "<0.001",
sprintf("%.3f", round(p.value, 3))),
estimate  = sprintf("%.3f", round(estimate, 3)),
std.error = sprintf("%.3f", round(std.error, 3)),
statistic = sprintf("%.3f", round(statistic, 3)),
conf.low  = sprintf("%.3f", round(conf.low, 3)),
conf.high = sprintf("%.3f", round(conf.high, 3))
)
rq1_table <- dplyr::bind_rows(
rq1_table,
tibble::tibble(
term      = c("R-squared", "Adjusted R-squared"),
estimate  = c(sprintf("%.3f", round(r2_value, 3)),
sprintf("%.3f", round(adj_r2, 3))),
std.error = "", statistic = "", p.value = "",
conf.low  = "", conf.high = ""
)
)
colnames(rq1_table) <- c(
"Variable", "Estimate", "Std Error", "t-value", "p-value",
"2.5% CI", "97.5% CI"
)
rownames(rq1_table) <- NULL
kable(
rq1_table,
caption = "Linear regression model for national happiness (cluster–robust SEs by country)",
booktabs = TRUE,
longtable = FALSE,
linesep  = "",
align    = c("l", "c", "c", "c", "c", "c", "c")
) %>%
kableExtra::kable_styling(full_width = FALSE, font_size = 9)
